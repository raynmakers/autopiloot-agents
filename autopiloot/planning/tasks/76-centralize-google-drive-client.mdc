---
description: "Centralize Google Drive client factory and reuse across tools"
globs: []
alwaysApply: false
---

id: "TASK-0076"
title: "Centralize Google Drive client factory"
status: "planned"
priority: "P2"
labels: ["refactor", "drive", "factory"]
dependencies: ["TASK-0075"]
created: "2025-10-14"

# 1) High-Level Objective

Provide `core/drive.py` with `get_drive_service(scopes: List[str])` to create an authenticated Drive service reused by Drive/Summarizer/Strategy tools.

# 2) Background / Context

Repeated credential loading and `build('drive', 'v3', ...)` calls appear in multiple tools.

# 3) Assumptions & Constraints

- Constraint: Use service account via `GOOGLE_APPLICATION_CREDENTIALS` and env_loader.

# 4) Dependencies

- files/agents/autopiloot/strategy_agent/tools/save_strategy_artifacts.py
- files/agents/autopiloot/drive_agent/tools/\*

# 5) Steps

1. Create `agents/autopiloot/core/drive.py` exposing `get_drive_service(scopes=None)` with sensible defaults.
2. Replace manual client creation in tools with the factory.

# 6) Acceptance Criteria

- All Drive-using tools import the factory; duplicates removed.

# 7) Testing Strategy

- Mock `build` and credentials in a unit test; verify reuse and error handling.
